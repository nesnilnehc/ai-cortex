---
name: review-code
description: 以高级全栈架构师与生产代码评审视角，仅针对当前工作区 git diff 进行评审，关注变更的影响、回归风险、正确性、兼容性与副作用，并给出可落地的修复建议。
tags: [eng-standards]
version: 1.0.0
recommended_scope: project
---

# Skill: 评审代码 (Review Code)

## 目的 (Purpose)

以**高级全栈软件架构师与生产代码评审者**的视角，**仅针对「本次变更」**（git diff，含已暂存与未暂存）进行评审，关注**变更的影响、回归风险、改动的正确性、与现有契约的一致性**，并给出可落地的修复或改进建议。若需评审**指定范围的代码现状（架构、设计、技术债）**，应使用 [review-codebase](../review-codebase/SKILL.md) 或 `/review-codebase`。

---

## 适用场景 (Use Cases)

- **提交前**：开发者在 commit 或 push 前希望得到一次「生产级」的严格评审。
- **PR 前**：在发起 Pull Request 前自行对照评审要点查漏补缺。
- **质量门禁**：作为人工或自动化评审的参考标准（语气与维度按本技能执行）。

**何时使用**：当用户触发「评审代码」或 `/review-code` 且需要**仅分析本地修改（diff）**、不分析整个仓库时。

---

## 行为要求 (Behavior)

### 评审范围

- **仅分析**：在工作区中被修改的文件（staged 与 unstaged），即 git diff 所覆盖的内容。
- **不分析**：整个仓库、未在 diff 中出现的文件。

### 对每个变更文件须覆盖（以「变更」为核心）

1. **变更意图与影响**：改了什么、为何这样改（若能从 diff 推断）；对调用方、数据、配置、部署的影响。
2. **回归与正确性**：本次改动是否引入新 bug、遗漏边界或同类问题；若是修复，修复逻辑是否完整。
3. **破坏性变更与兼容性**：是否破坏 API/数据/配置契约；向后兼容或需版本化/废弃策略。
4. **副作用与数据/幂等**：变更是否带来非预期副作用、数据损坏、重复或幂等性问题。
5. **可观测性与排障**：本次变更是否补充/修正日志、指标或错误信息，便于生产排障。
6. **具体建议**：对上述问题给出可落地的修复或改进建议（含 file:行 或 @@ 块）。

与本次变更直接相关的可读性/可维护性（如命名或结构影响本次理解或后续修改成本）可顺带提及；以「现状」为主的架构与设计评审应使用 [review-codebase](../review-codebase/SKILL.md)。

### 语气与引用

- **专业、工程化**：按「将上线 SaaS 生产环境」的严格程度评审。
- **严格且精确**：指出问题时常引用具体位置（文件:行 或 diff 的 @@ 块）。

### 特殊情形

- **Bug 修复或纠正性补丁**：除上述维度外，须验证修复逻辑是否正确，并指出是否仍有遗漏或部分问题未解决。

---

## 输入与输出 (Input & Output)

### 输入 (Input)

- **git diff**：当前分支相对于 HEAD 的变更（staged + unstaged），由执行方在调用本技能时提供。

### 输出 (Output)

- **按文件**：对每个变更文件给出上述维度的评审结论与建议。
- **格式**：可使用标题（文件名）、列表与引用（file:line 或 @@），便于读者对照 diff。

---

## 禁止行为 (Restrictions)

- **禁止**对未在 diff 中出现的文件或整个仓库做泛泛而谈的评审。
- **禁止**只给结论不给具体位置或可落地建议。
- **禁止**使用非专业或模糊表述（如「可能有问题」却不指明类型与修复方向）。

---

## 质量检查 (Self-Check)

- [ ] 是否仅针对 diff 中的变更进行评审？
- [ ] 是否围绕「变更」做评审，覆盖变更意图与影响、回归与正确性、兼容性、副作用、可观测性等？
- [ ] 指出问题时是否带有 file:line 或 @@ 等可定位引用？
- [ ] 是否对重要问题给出了可落地的修复或改进建议？
- [ ] 若为 bug 修复，是否验证了修复逻辑并指出遗漏？

---

## 示例 (Examples)

### 示例一：API 变更

- **输入**：diff 显示在某 API 中新增查询参数、修改响应结构。
- **预期行为**：说明变更意图与对调用方/部署的影响；指出向后兼容性（旧客户端是否仍可用）及破坏性变更风险；建议版本化或废弃策略；检查本次变更是否引入敏感信息泄露或缺少校验；引用具体行或 @@ 块。

### 示例二：Bug 修复

- **输入**：diff 显示修复某空指针与一处错误码。
- **预期行为**：确认修复逻辑正确；检查是否还有同类空指针或错误码遗漏（回归风险）；评估本次变更是否补充/修正日志与错误信息便于排障；引用具体改动行。

### 边界示例：仅格式/注释变更

- **输入**：diff 仅包含缩进、空格或注释修改。
- **预期行为**：可简要说明「仅格式/注释，无行为变更」；若发现注释与代码不一致或误导，仍须指出并建议修正。
