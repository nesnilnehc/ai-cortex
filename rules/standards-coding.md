---
name: standards-coding
scope: 全库代码
---

# Rule: 通用编码原则 (Coding Principles)

## 适用范围 (Scope)

项目内所有代码（跨语言）。作为通用原则，与语言特定规则（如 standards-shell）同时生效时，两者均须满足。

## 强制约束 (Constraints)

1. **代码组织**：模块化、单一职责、自顶向下、相关函数就近放置。
2. **注释**：说明「为什么」而非「做什么」；非显而易见才注释；复杂函数必须有参数与返回值说明；代码变更时同步更新注释。
3. **命名**：描述性、一致、避免未公认缩写、在作用域内有意义。
4. **错误处理**：快速失败、错误信息含上下文与解决建议、统一错误处理机制、错误路径下正确清理资源。
5. **日志**：使用标准日志级别与统一日志函数、不直接 echo/print 调试信息、日志含足够上下文、支持通过参数控制详细程度。
6. **简洁性**：遵循 DRY、避免过度抽象、不保留注释掉的死代码与过时注释。
7. **重构**：发现重复、函数过长（>50 行）、嵌套过深（>3 层）或过时注释时进行重构；重构时保持功能不变、小步改进、及时验证。

## 违规示例 (Bad Patterns)

- 注释仅重复代码逻辑（如 `// 设置变量 x 为 1`）。
- 错误被吞掉或仅打印无上下文信息。
- 多处复制相同逻辑未提取为函数。
- 保留大段注释掉的旧实现。

## 修正指南 (Remediation)

1. 将重复逻辑提取为函数；用早返回减少嵌套。
2. 用统一日志函数替换直接 echo/print；错误路径补充上下文与清理。
3. 删除死代码与过时注释；复杂逻辑补充「原因」类注释与函数文档。
